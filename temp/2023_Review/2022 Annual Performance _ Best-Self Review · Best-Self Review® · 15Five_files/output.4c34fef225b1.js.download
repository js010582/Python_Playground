function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}
function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}
function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}
function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}
function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}
function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}
(function mentionsCore(){'use strict';var MENTION_EXTRACTOR_RE=/@[a-zA-Z0-9]{2,100}/gi;var EMAIL_MENTION_EXTRACTOR_RE=/([a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.(?:[.a-zA-Z0-9-][a-zA-Z0-9]+)+)/g;var mentionUsers;var mentionGroups;function keyBy(array,propName){return Object.fromEntries(array.map(function(item){return[item[propName],item];}));}
function uniq(){var array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];return array.filter(function(item,index,arr){return index===arr.indexOf(item);});}
function getMatches(regex,str){var match=regex.exec(str);return match?[match].concat(_toConsumableArray(getMatches(regex,str))):[];}
function fetchMentions(url){return $.when($.ready).then(function onReady(){var $token=$('.mention_users_direct_access_token');var directAccessToken=$token.data('directAccessToken');return $.get({url:url,beforeSend:function beforeSend(xhr){if(directAccessToken){xhr.setRequestHeader('X-FFDirectAccessToken',directAccessToken);}}});});}
function getMentionUsers(){if(!mentionUsers){mentionUsers=fetchMentions(Urls.ff_mention_user_list()).then(function(_ref){var users=_ref.mention_users;return{list:users,byEmail:keyBy(users,'canonical_email'),byMentionName:keyBy(users,'mention_name')};});}
return mentionUsers;}
function getMentionUserList(){return getMentionUsers().then(function(users){return users.list;});}
function getMentionGroups(){if(!mentionGroups){mentionGroups=fetchMentions(Urls.ff_mention_group_list()).then(function(_ref2){var groups=_ref2.mention_groups;return{list:groups,byMentionName:keyBy(groups,'mention_name')};});}
return mentionGroups;}
function getMentionGroupList(){return getMentionGroups().then(function(groups){return groups.list;});}
function findMentionUserByEmail(email){return getMentionUsers().then(function(users){return users.byEmail[email.toLowerCase()];});}
function findMentions(str){return uniq(str.match(MENTION_EXTRACTOR_RE)||[]);}
function getMentionName(mention){return mention.slice(1);}
function findEmailMatches(str){var emailRegex=new RegExp(EMAIL_MENTION_EXTRACTOR_RE);return getMatches(emailRegex,str);}
function findExternalEmailMatches(str){return Promise.all(findEmailMatches(str).map(function(emailMatch){return findMentionUserByEmail(emailMatch[0]).then(function(mentionUser){return mentionUser?null:emailMatch;});})).then(function(emails){return emails.filter(Boolean);});}
function extractUserMentions(str){var mentions=findMentions(str);return getMentionUsers().then(function(users){return mentions.map(function(mention){return{mention:mention,user:users.byMentionName[getMentionName(mention)]};}).filter(function(mention){return!!mention.user;});});}
function extractGroupMentions(str){var mentions=findMentions(str);return getMentionGroups().then(function(groups){return mentions.map(function(mention){return{mention:mention,group:groups.byMentionName[getMentionName(mention)]};}).filter(function(mention){return!!mention.group;});});}
function extractEmailMentions(str){return uniq(findEmailMatches(str).map(function(emailMatch){return emailMatch[0];}));}
function extractMentions(str){return $.when(extractUserMentions(str),extractGroupMentions(str),extractEmailMentions(str)).then(function(users,groups,emails){return{users:users,groups:groups,emails:emails};});}
window.Mentions={getMentionUserList:getMentionUserList,getMentionGroupList:getMentionGroupList,findMentions:findMentions,findExternalEmailMatches:findExternalEmailMatches,extractMentions:extractMentions};$(document).trigger('loaded.mentions');})();;function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}
function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key);}
function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.");}return(hint==="string"?String:Number)(input);}
(function(){'use strict';var InputTextPopover=function(){function InputTextPopover(_ref){var input=_ref.input,content=_ref.content,index=_ref.index;_classCallCheck(this,InputTextPopover);this.$input=$(input);this.content=content;this.$popoverTarget=$('<div>').css({position:'absolute'}).appendTo(this.$input.parent()).popover({content:content,html:true,placement:'bottom',trigger:'manual',container:this.$input.parent()});this.setPosition(index);this.$popoverTarget.popover('show');}
_createClass(InputTextPopover,[{key:"setPosition",value:function setPosition(index){var offset=this.$input.caret('offset',index);offset.left=this.$input.data('leftOffset')||offset.left;this.$popoverTarget.offset(offset).height(offset.height).popover('update');}},{key:"destroy",value:function destroy(){this.$popoverTarget.popover('dispose').remove();}}]);return InputTextPopover;}();window.InputTextPopover=InputTextPopover;})();;function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}
function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}
function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}
function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}
function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}
function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}
window.mentionList=[];$(function onMentionRender(){'use strict';var targetSelector='.js-mention';function mentionSort(a,b){return a.mention_name.localeCompare(b.mention_name);}
function renderAvatar(item){if(item.image){return"<img class=\"avatar\" src=\"".concat(item.image,"\" alt=\"").concat(item.mention_name,"\">");}
return"<div class=\"avatar\">".concat(item.mention_name.charAt(0),"</div>");}
function createMentionAutocompleteConfig(){var mentionUsers=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var mentionGroups=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var _ref=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},_ref$minQueryLength=_ref.minQueryLength,minQueryLength=_ref$minQueryLength===void 0?0:_ref$minQueryLength;var mentionList=[].concat(_toConsumableArray(mentionUsers),_toConsumableArray(mentionGroups)).sort(mentionSort);window.mentionList=mentionList;return{at:'@',data:mentionList,displayTpl:function displayTpl(item){return DOMPurify.sanitize("\n          <li class=\"truncate\">\n            ".concat(renderAvatar(item),"\n            <span class=\"align-middle\">\n              ").concat(item.mention_name," <small>").concat(item.name,"</small>\n            </span>\n          </li>\n        "));},insertTpl:function insertTpl(map){return map['atwho-at']+map.mention_name;},callbacks:{filter:function filter(query,data,searchKey){if(query.length<minQueryLength){return[];}
return $.fn.atwho["default"].callbacks.filter(query,data,searchKey);}},searchKey:'mention_name',limit:200};}
$.when(Mentions.getMentionUserList(),Mentions.getMentionGroupList()).done(function onDone(userList,groupList){var baseConfig=createMentionAutocompleteConfig(userList,groupList);var configForInputWithMentionInstructions=createMentionAutocompleteConfig(userList,groupList,{minQueryLength:1});function initMentionInput(input){var $input=$(input);if(!$input.length){return;}
if($input.data().mentionInstructionsPopover){$input.atwho(configForInputWithMentionInstructions);}else{$input.atwho(baseConfig);}}
initMentionInput($("".concat(targetSelector,":focus")));$('body').on('focus',targetSelector,function(event){return initMentionInput(event.target);});});});;$(function(){'use strict';var destroyTrigger='mousedown focusin';var detectTrigger='focus input inserted.atwho';var mentionFieldSelector='.js-mention';var $template=$('.js-all-mention-confirmation-popover');var $popoverContent=$($template.html());var dismissAllCheckboxSelector='.js-mention-popover-dismiss-all';var allMentionPopover;function removeActionOutsideListener(){$('body').off(destroyTrigger,onActionOutside);}
function removePopover(){if(allMentionPopover){allMentionPopover.destroy();allMentionPopover=undefined;removeActionOutsideListener();}}
function onActionOutside(event){if(allMentionPopover&&!allMentionPopover.$popoverTarget.parent().has(event.target).length){removePopover();}}
function closePopover(event){var $input=event.data.$input;var $dismissAllCheckbox=allMentionPopover.content.find(dismissAllCheckboxSelector);var editAfterClose=$(this).data('editAfterClose');var dismissAll=$dismissAllCheckbox.prop('checked');if(dismissAll){var _$popoverContent$data=$popoverContent.data(),optionalContent=_$popoverContent$data.optionalContent;$.get(Urls.ff_contentdisplay_dont_show(optionalContent));}
removePopover();$('body').off(detectTrigger,mentionFieldSelector,detectAllMention);if(editAfterClose){$input.focus();}}
function detectAllMention(){var $input=$(this);var allMentionIndex=$input.val().indexOf('@all');if(allMentionIndex>=0){if(!allMentionPopover){allMentionPopover=new InputTextPopover({input:this,content:$popoverContent,index:allMentionIndex});$popoverContent.one('click','.js-mention-popover-close',{$input:$input},closePopover);}else{var popoverTargetIndex=allMentionIndex+2;if(!allMentionPopover){allMentionPopover=new InputTextPopover({input:this,content:$popoverContent,index:popoverTargetIndex});}else{allMentionPopover.setPosition(popoverTargetIndex);}}}else if(allMentionPopover){removePopover();}}
function init(){Mentions.getMentionGroupList().then(function(groupList){var isAllFeatureEnabled=groupList.some(function(group){return group.mention_name==='all';});if(isAllFeatureEnabled){$('body').on(detectTrigger,mentionFieldSelector,detectAllMention);}});}
if($template.length){init();}});;$(function onEmailMentions(){'use strict';var destroyTrigger='mousedown focusin';var updateTrigger='input focusin';var emailMentionPopoverSelector='[data-email-mention-popover]';var popoverEmailSelector='.js-mention-popover-email';var dismissAllCheckboxSelector='.js-mention-popover-dismiss-all';var dismissedEmails=[];var inputTextPopover;function isMatchNotExcluded(match){return!dismissedEmails.includes(match[0]);}
function addEmailMentionListener(){$('body').on(updateTrigger,emailMentionPopoverSelector,updatePopover);}
function removeEmailMentionListener(){$('body').off(updateTrigger,emailMentionPopoverSelector,updatePopover);}
function addActionOutsideListener(){$('body').on(destroyTrigger,onActionOutside);}
function removeActionOutsideListener(){$('body').off(destroyTrigger,onActionOutside);}
function removePopover(){if(inputTextPopover){inputTextPopover.destroy();inputTextPopover=undefined;removeActionOutsideListener();}}
function onActionOutside(event){if(inputTextPopover&&!inputTextPopover.$popoverTarget.parent().has(event.target).length){removePopover();}}
function closePopover(event){var $input=event.data.$input;var $dismissAllCheckbox=inputTextPopover.content.find(dismissAllCheckboxSelector);var editAfterClose=$(this).data('editAfterClose');var dismissAll=$dismissAllCheckbox.prop('checked');if(dismissAll){var contentName=$input.data('emailMentionContentName');$.get(Urls.ff_contentdisplay_dont_show(contentName));removeEmailMentionListener();}else{dismissedEmails.push(inputTextPopover.content.find(popoverEmailSelector).text().trim());}
removePopover();if(editAfterClose){$input.focus();}}
function updatePopoverContent(email){var $popoverEmail=inputTextPopover.content.find(popoverEmailSelector);var currentEmail=$popoverEmail.text().trim();if(currentEmail!==email){$popoverEmail.text(email);inputTextPopover.content.find(dismissAllCheckboxSelector).prop('checked',false);}}
function updatePopover(){var $input=$(this);Mentions.findExternalEmailMatches($input.val()).then(function then(externalEmails){var lastEmailMatch=externalEmails.filter(isMatchNotExcluded).pop();if(lastEmailMatch){var emailMentionIndex=lastEmailMatch.index+lastEmailMatch[0].indexOf('@');if(!inputTextPopover){var $popoverContent=$($input.data('emailMentionPopover'));inputTextPopover=new InputTextPopover({input:$input,content:$popoverContent,index:emailMentionIndex});$popoverContent.one('click','.js-mention-popover-close',{$input:$input},closePopover);addActionOutsideListener();}else{inputTextPopover.setPosition(emailMentionIndex);}
updatePopoverContent(lastEmailMatch[0]);}else if(inputTextPopover){removePopover();}});}
addEmailMentionListener();});;function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}
function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}
function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}
function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}
function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}
function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}
$(function onMentionCount(){'use strict';var NOTIFIED_PEOPLE_MAX_DISPLAY_COUNT=10;var mentionCountModalSelector='#mentionCountModal';function createCounter(contentType){var $count=$("\n      <button\n        type=\"button\"\n        class=\"btn-link\"\n        data-toggle=\"tooltip\"\n        data-html=\"true\"\n        data-delay=\"200\"\n        data-sticky=\"true\"\n      >\n    ");var $el=$('<div class="u-mt-5">').hide().append($count,' will be notified.');var isComment=contentType==='comment';var mentionsSerialized;function setContent(mentionsStr){var count=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var mentionedUsers=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var alsoNotified=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'';var tooltipUserList=mentionedUsers.slice();var isPrivate=isComment?$el.closest('.js-post-comment').hasClass('is-private'):false;if(alsoNotified){tooltipUserList.push("\n          <button\n            type=\"button\"\n            class=\"btn-link js-mention-count-modal-open\"\n            data-toggle=\"modal\"\n            data-target=\"".concat(mentionCountModalSelector,"\"\n            data-mentions=\"").concat(mentionsStr,"\"\n            data-count=\"").concat(count,"\"\n          >").concat(alsoNotified,"</button>\n        "));}
$el.toggle(!!count).closest('.js-mention-counter-label').find('.js-insert-mention-symbol').prop('hidden',!!count);if(isComment&&isPrivate&&count===0){$count.text('Nobody').attr('data-original-title','@mention people or groups to allow them to see this private comment');$el.show();}else{$count.text("".concat(count," ").concat(count===1?'person':'people')).attr('data-original-title',"\n            <div class=\"o-info-tooltip__content\">\n              ".concat(tooltipUserList.join('<br>'),"\n            </div>\n          "));}
if($count.data('bs.tooltip')&&$($count.data('bs.tooltip').tip).is(':visible')){$count.tooltip('show');}}
function clearContent(){setContent();}
function setMentions(mentions){var newMentionsSerialized=[].concat(_toConsumableArray(mentions.users.map(function(userMention){return userMention.mention;})),_toConsumableArray(mentions.groups.map(function(groupMention){return groupMention.mention;})),_toConsumableArray(mentions.emails)).join();if(mentionsSerialized!==newMentionsSerialized){mentionsSerialized=newMentionsSerialized;if(newMentionsSerialized){var mentionCountResult;if(!mentions.groups.length&&!mentions.emails.length){var users=mentions.users.map(function(userMention){return userMention.user;});var alsoNotifiedCount=users.length-NOTIFIED_PEOPLE_MAX_DISPLAY_COUNT;mentionCountResult=$.when({count:users.length,mentioned_users:users.map(function(user){return user.name;}).sort(function(a,b){return a.localeCompare(b);}).slice(0,NOTIFIED_PEOPLE_MAX_DISPLAY_COUNT),also_notified:alsoNotifiedCount>0?"and ".concat(alsoNotifiedCount," more..."):''});}else{mentionCountResult=$.get(Urls.ff_mention_count(),{text:newMentionsSerialized});}
mentionCountResult.then(function(res){if(mentionsSerialized===newMentionsSerialized){setContent(newMentionsSerialized,res.count,res.mentioned_users,res.also_notified);}});}else{clearContent();}}}
$el.on('click','.js-mention-count-modal-open',function(){return $count.tooltip('hide');});return{$el:$el,setMentions:setMentions};}
var updateCount=throttle(function updateCount(){var $counterContainer=$(this);var $counterLabel=$counterContainer.find('.js-mention-counter-label');var $input=$counterContainer.find('.js-mention');var dataKey='mention.counter';var contentType=$counterContainer.data('mentionsContentType');var isComment=contentType==='comment';var isPrivate=isComment?$input.data('isPrivate'):false;var autofill=$input.data('highFiveAutofill');var skipAutofilledHighFive=autofill&&autofill===$input.val().trim();var counter=$input.data(dataKey);if(!counter&&!skipAutofilledHighFive){counter=createCounter(contentType);counter.$el.appendTo($counterLabel);$input.data(dataKey,counter);}
if(isComment){counter.$el.toggle(isPrivate);}
if(!isComment||isPrivate){if(!skipAutofilledHighFive){Mentions.extractMentions($input.val()).then(counter.setMentions.bind(counter));}}},200);function insertMentionSymbol(){var $field=$(this).closest('.js-mention-counter-container').find('.js-mention');var symbol='@';var beforeSelection=$field.val()[$field.prop('selectionStart')-1];if(beforeSelection&&!beforeSelection.match(/\s/)){symbol=" ".concat(symbol);}
$field.insertText(symbol);}
function renderModalUser(user){var userNameSanitized=DOMPurify.sanitize(user.name);return"\n      <li class=\"u-mb-15\">\n        <div class=\"flex items-center\">\n          <img src=\"".concat(user.avatar_url,"\" alt=\"").concat(userNameSanitized,"\" class=\"avatar\">\n          <div class=\"leading-tight u-ml-15\">\n            <div class=\"text-16\">").concat(userNameSanitized,"</div>\n            <div class=\"text-secondary\">").concat(DOMPurify.sanitize(user.title),"</div>\n          </div>\n        </div>\n      </li>\n    ");}
function loadModalContent(event){var $modal=$(event.target);var $count=$modal.find('.js-mention-count-modal-count');var $list=$modal.find('.js-mention-count-modal-list');var $spinner=$modal.find('.js-mention-count-modal-spinner');var _$$data=$(event.relatedTarget).data(),mentions=_$$data.mentions,count=_$$data.count;$count.text(count);$list.empty();$spinner.show();$.get(Urls.ff_mention_mentioned_users(),{text:mentions}).then(throwErrorResponse)["catch"](showAjaxError('Failed to load mentioned users.')).then(function(res){$list.html(res.mentioned_users.map(renderModalUser));$spinner.hide();})["catch"](function(){return $modal.modal('hide');});}
$(mentionCountModalSelector).on('show.bs.modal',loadModalContent);$('body').on('focus input inserted.atwho','.js-mention-counter-container',updateCount).on('click','.js-insert-mention-symbol',insertMentionSymbol).on('mousedown','.js-insert-mention-symbol',false);});;$(function(){'use strict';var popoverHandlers=new Map();function isWhitespace(_char){return!!_char.trim().length;}
function isMentionStartAtIndex(value,index){var previousChar=value[index-1];if(previousChar&&isWhitespace(previousChar)){return false;}
return value[index]==='@';}
function createPopover(input,index){var _$$data=$(input).data(),mentionInstructionsPopover=_$$data.mentionInstructionsPopover,isEmailMentionsSupported=_$$data.isEmailMentionsSupported;var popoverContent=new Vue({data:function data(){return{isEmailMentionsSupported:isEmailMentionsSupported};},template:mentionInstructionsPopover}).$mount();var popover=new InputTextPopover({input:input,content:popoverContent.$el,index:index});return{setPosition:popover.setPosition.bind(popover),destroy:function destroy(){popover.destroy();popoverContent.$destroy();}};}
function removePopover(input){var popoverHandler=popoverHandlers.get(input);if(popoverHandler){popoverHandler.destroy();popoverHandlers["delete"](input);}}
function showPopoverAtIndex(input,index){if(popoverHandlers.has(input)){popoverHandlers.get(input).setPosition(index);}else{popoverHandlers.set(input,createPopover(input,index));}}
$('body').on('blur','.js-mention',function(event){return removePopover(event.target);}).on('click focus input','.js-mention[data-mention-instructions-popover]',function(event){var input=event.target;var value=input.value;var caretIndex=input.selectionStart;if(isMentionStartAtIndex(value,caretIndex-1)){showPopoverAtIndex(input,caretIndex);}else{removePopover(input);}});});;